<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Huangkai,huankai"><title>Redis安装 | HuangkaiのBlog</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis安装</h1><a id="logo" href="/.">HuangkaiのBlog</a><p class="description">学而不思则罔 思而不学则殆</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Redis安装</h1><div class="post-meta"><a href="/2018/02/22/Redis_01_安装教程/#comments" class="comment-count"></a><p><span class="date">Feb 22, 2018</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><ul>
<li>系统版本：CentOS Linux release 7.3.1611 (Core)</li>
<li>Redis版本：4.0.1</li>
</ul>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>下载地址： 请点击 <a href="http://download.redis.io/releases/redis-4.0.1.tar.gz" target="_blank" rel="noopener">官网</a> 下载 ，下载完成后，上传到 Linux某个目录中。</p>
<p>也可以直接使用 wget 命令下载：</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 soft]$ wget <span class="name">http</span>://download.redis.<span class="built_in">io</span>/releases/redis<span class="number">-4.0</span><span class="number">.1</span>.tar.gz</span><br><span class="line"><span class="comment">--2017-10-20 14:10:53--  http://download.redis.io/releases/redis-4.0.1.tar.gz</span></span><br><span class="line">Resolving download.redis.<span class="built_in">io</span> (download.redis.<span class="built_in">io</span>)... <span class="number">109.74</span><span class="number">.203</span><span class="number">.151</span></span><br><span class="line">Connecting to download.redis.<span class="built_in">io</span> (download.redis.<span class="built_in">io</span>)|<span class="number">109.74</span><span class="number">.203</span><span class="number">.151</span>|:<span class="number">80.</span>.. connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line"><span class="name">Length</span>: <span class="number">1711660</span> (<span class="number">1.6</span>M) [application/x-gzip]</span><br><span class="line">Saving <span class="name">to</span>: ‘redis<span class="number">-4.0</span><span class="number">.1</span>.tar.gz’</span><br><span class="line"></span><br><span class="line"><span class="number">100</span>%[==============================================================================================================================================================================================<span class="function">=&gt;</span>] <span class="number">1</span>,<span class="number">711</span>,<span class="number">660</span>    <span class="number">585</span>KB/s   <span class="keyword">in</span> <span class="number">2.9</span>s   </span><br><span class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-20</span> <span class="number">14</span>:<span class="number">10</span>:<span class="number">57</span> (<span class="number">585</span> KB/s) - ‘redis<span class="number">-4.0</span><span class="number">.1</span>.tar.gz’ saved [<span class="number">1711660</span>/<span class="number">1711660</span>]</span><br><span class="line">[huangkai@sjq01 soft]$ ll</span><br><span class="line">total <span class="number">1672</span></span><br><span class="line">-rw-rw-r<span class="comment">--. 1 huangkai huangkai 1711660 Jul 24 21:59 redis-4.0.1.tar.gz</span></span><br></pre></td></tr></table></figure>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 soft]$ wget <span class="name">http</span>://download.redis.<span class="built_in">io</span>/releases/redis<span class="number">-4.0</span><span class="number">.1</span>.tar.gz</span><br><span class="line"><span class="comment">--2017-10-20 14:10:53--  http://download.redis.io/releases/redis-4.0.1.tar.gz</span></span><br><span class="line">Resolving download.redis.<span class="built_in">io</span> (download.redis.<span class="built_in">io</span>)... <span class="number">109.74</span><span class="number">.203</span><span class="number">.151</span></span><br><span class="line">Connecting to download.redis.<span class="built_in">io</span> (download.redis.<span class="built_in">io</span>)|<span class="number">109.74</span><span class="number">.203</span><span class="number">.151</span>|:<span class="number">80.</span>.. connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line"><span class="name">Length</span>: <span class="number">1711660</span> (<span class="number">1.6</span>M) [application/x-gzip]</span><br><span class="line">Saving <span class="name">to</span>: ‘redis<span class="number">-4.0</span><span class="number">.1</span>.tar.gz’</span><br><span class="line"></span><br><span class="line"><span class="number">100</span>%[==============================================================================================================================================================================================<span class="function">=&gt;</span>] <span class="number">1</span>,<span class="number">711</span>,<span class="number">660</span>    <span class="number">585</span>KB/s   <span class="keyword">in</span> <span class="number">2.9</span>s   </span><br><span class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-20</span> <span class="number">14</span>:<span class="number">10</span>:<span class="number">57</span> (<span class="number">585</span> KB/s) - ‘redis<span class="number">-4.0</span><span class="number">.1</span>.tar.gz’ saved [<span class="number">1711660</span>/<span class="number">1711660</span>]</span><br><span class="line">[huangkai@sjq01 soft]$ ll</span><br><span class="line">total <span class="number">1672</span></span><br><span class="line">-rw-rw-r<span class="comment">--. 1 huangkai huangkai 1711660 Jul 24 21:59 redis-4.0.1.tar.gz</span></span><br></pre></td></tr></table></figure>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>1、解压文件</strong><br>解压文件到指定目录 (<code>/usr/local/</code>)</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 soft]$ sudo tar xzf redis-4.0.1.tar.gz -C /usr/local/</span><br><span class="line">[sudo] password for huangkai: </span><br><span class="line">[huangkai@sjq01 soft]$ cd /usr/local/redis-4.0.1</span><br><span class="line">[huangkai@sjq01 redis-4.0.1]$ ll</span><br><span class="line">total 268</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai<span class="number"> 127778 </span>Jul<span class="number"> 24 </span>21:58 00-RELEASENOTES</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai    <span class="number"> 53 </span>Jul<span class="number"> 24 </span>21:58 BUGS</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 1815 </span>Jul<span class="number"> 24 </span>21:58 CONTRIBUTING</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 1487 </span>Jul<span class="number"> 24 </span>21:58 COPYING</span><br><span class="line">drwxrwxr-x. <span class="number"> 6 </span>huangkai huangkai   <span class="number"> 124 </span>Jul<span class="number"> 24 </span>21:58 deps</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai    <span class="number"> 11 </span>Jul<span class="number"> 24 </span>21:58 INSTALL</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 151 </span>Jul<span class="number"> 24 </span>21:58 Makefile</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 4223 </span>Jul<span class="number"> 24 </span>21:58 MANIFESTO</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai <span class="number"> 20530 </span>Jul<span class="number"> 24 </span>21:58 README.md</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai <span class="number"> 57764 </span>Jul<span class="number"> 24 </span>21:58 redis.conf</span><br><span class="line">-rwxrwxr-x. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 271 </span>Jul<span class="number"> 24 </span>21:58 runtest</span><br><span class="line">-rwxrwxr-x. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 280 </span>Jul<span class="number"> 24 </span>21:58 runtest-cluster</span><br><span class="line">-rwxrwxr-x. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 281 </span>Jul<span class="number"> 24 </span>21:58 runtest-sentinel</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 7606 </span>Jul<span class="number"> 24 </span>21:58 sentinel.conf</span><br><span class="line">drwxrwxr-x. <span class="number"> 3 </span>huangkai huangkai  <span class="number"> 4096 </span>Jul<span class="number"> 24 </span>21:58 src</span><br><span class="line">drwxrwxr-x.<span class="number"> 10 </span>huangkai huangkai   <span class="number"> 167 </span>Jul<span class="number"> 24 </span>21:58 tests</span><br><span class="line">drwxrwxr-x. <span class="number"> 8 </span>huangkai huangkai  <span class="number"> 4096 </span>Jul<span class="number"> 24 </span>21:58 utils</span><br><span class="line">[huangkai@sjq01 redis-4.0.1]$</span><br></pre></td></tr></table></figure>
<p>如上所示， tar 命令 <code>-C</code> 参数，表示把 tar.gz包解压到 <code>/usr/local</code>目录中，上面需要输入密码，是因为<code>/usr/local</code>目录需要root用户才能访问，此时并不是root用户登陆。<br><strong>2、赋予权限(可选操作)</strong></p>
<p>给当前用户redis操作的权限(可选，如果你安装的目录普通用户有权限访问，或者你使用的是root用户，此操作不需要，如果没有权限，后面的操作可能都会报没有权限的错误)<br>    将redis-4.0.1目录及其子目录的所有者给 huangkai </p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@sjq01 local]<span class="comment"># chown -R huangkai:huangkai redis-4.0.1</span></span><br><span class="line">[root@sjq01 local]<span class="comment"># ll</span></span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>bin</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>etc</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>games</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>include</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>lib</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>lib64</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>libexec</span><br><span class="line">drwxrwxr-x.<span class="number"> 6 </span>huangkai huangkai<span class="number"> 4096 </span>Jul<span class="number"> 24 </span>21:58 redis-4.0.1</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>sbin</span><br><span class="line">drwxr-xr-x.<span class="number"> 5 </span>root     root      <span class="number"> 49 </span>Aug<span class="number"> 16 </span>09:08 share</span><br><span class="line">drwxr-xr-x.<span class="number"> 2 </span>root     root       <span class="number"> 6 </span>Nov <span class="number"> 5 </span><span class="number"> 2016 </span>src</span><br></pre></td></tr></table></figure>
<p><strong>3、创建安装目录 </strong><br>(bin 和 conf)：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 redis-4.0.1]$ mkdir bin conf</span><br><span class="line">[huangkai@sjq01 redis-4.0.1]$ ll</span><br><span class="line">total 268</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai<span class="number"> 127778 </span>Jul<span class="number"> 24 </span>21:58 00-RELEASENOTES</span><br><span class="line">drwxrwxr-x. <span class="number"> 2 </span>huangkai huangkai     <span class="number"> 6 </span>Oct<span class="number"> 20 </span>15:36 bin</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai    <span class="number"> 53 </span>Jul<span class="number"> 24 </span>21:58 BUGS</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 1815 </span>Jul<span class="number"> 24 </span>21:58 CONTRIBUTING</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 1487 </span>Jul<span class="number"> 24 </span>21:58 COPYING</span><br><span class="line">drwxrwxr-x. <span class="number"> 6 </span>huangkai huangkai   <span class="number"> 124 </span>Jul<span class="number"> 24 </span>21:58 deps</span><br><span class="line">drwxrwxr-x. <span class="number"> 2 </span>huangkai huangkai     <span class="number"> 6 </span>Oct<span class="number"> 20 </span>15:36 conf</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai    <span class="number"> 11 </span>Jul<span class="number"> 24 </span>21:58 INSTALL</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 151 </span>Jul<span class="number"> 24 </span>21:58 Makefile</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 4223 </span>Jul<span class="number"> 24 </span>21:58 MANIFESTO</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai <span class="number"> 20530 </span>Jul<span class="number"> 24 </span>21:58 README.md</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai <span class="number"> 57764 </span>Jul<span class="number"> 24 </span>21:58 redis.conf</span><br><span class="line">-rwxrwxr-x. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 271 </span>Jul<span class="number"> 24 </span>21:58 runtest</span><br><span class="line">-rwxrwxr-x. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 280 </span>Jul<span class="number"> 24 </span>21:58 runtest-cluster</span><br><span class="line">-rwxrwxr-x. <span class="number"> 1 </span>huangkai huangkai   <span class="number"> 281 </span>Jul<span class="number"> 24 </span>21:58 runtest-sentinel</span><br><span class="line">-rw-rw-r--. <span class="number"> 1 </span>huangkai huangkai  <span class="number"> 7606 </span>Jul<span class="number"> 24 </span>21:58 sentinel.conf</span><br><span class="line">drwxrwxr-x. <span class="number"> 3 </span>huangkai huangkai  <span class="number"> 4096 </span>Jul<span class="number"> 24 </span>21:58 src</span><br><span class="line">drwxrwxr-x.<span class="number"> 10 </span>huangkai huangkai   <span class="number"> 167 </span>Jul<span class="number"> 24 </span>21:58 tests</span><br><span class="line">drwxrwxr-x. <span class="number"> 8 </span>huangkai huangkai  <span class="number"> 4096 </span>Jul<span class="number"> 24 </span>21:58 utils</span><br><span class="line">[huangkai@sjq01 redis-4.0.1]$</span><br></pre></td></tr></table></figure></p>
<p><strong>3、编译安装</strong></p>
<p>编译:    <font color="red"><strong> make</strong> </font><br>编译安装:<font color="red"><strong>sudo make install PREFIX=/usr/local/redis-4.0.1/ </strong></font> ，会在 <code>/usr/local/redis-4.0.1/bin</code>目录中创建Redis脚本文件<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 redis-4.0.1]$ make</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">一系列编译与安装信息</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">[huangkai@sjq01 redis-4.0.1]$ sudo make <span class="keyword">install</span> PREFIX=/usr/<span class="keyword">local</span>/redis<span class="number">-4.0</span><span class="number">.1</span>/</span><br><span class="line"><span class="comment">----日 志 信 息 开 始------</span></span><br><span class="line">cd src &amp;&amp; make <span class="keyword">install</span></span><br><span class="line">make[<span class="number">1</span>]: Entering <span class="keyword">directory</span> <span class="string">`/usr/local/redis-4.0.1/src'</span></span><br><span class="line"><span class="string">    CC Makefile.dep</span></span><br><span class="line"><span class="string">make[1]: Leaving directory `</span>/usr/<span class="keyword">local</span>/redis<span class="number">-4.0</span><span class="number">.1</span>/src<span class="string">'</span></span><br><span class="line"><span class="string">make[1]: Entering directory `/usr/local/redis-4.0.1/src'</span></span><br><span class="line">Hint: It<span class="string">'s a good idea to run '</span>make <span class="keyword">test</span><span class="string">' ;)</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">    INSTALL install</span></span><br><span class="line"><span class="string">make[1]: Leaving directory `/usr/local/redis-4.0.1/src'</span></span><br><span class="line"><span class="comment">----日 志 信 息 结 束------</span></span><br><span class="line">[huangkai@sjq01 redis<span class="number">-4.0</span><span class="number">.1</span>]$ </span><br><span class="line">[huangkai@sjq01 <span class="keyword">bin</span>]$ pwd</span><br><span class="line">/usr/<span class="keyword">local</span>/redis<span class="number">-4.0</span><span class="number">.1</span>/<span class="keyword">bin</span></span><br><span class="line">[huangkai@sjq01 <span class="keyword">bin</span>]$ ll</span><br><span class="line">total <span class="number">21768</span></span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">2450880</span> <span class="keyword">Oct</span> <span class="number">20</span> <span class="number">15</span>:<span class="number">55</span> redis-<span class="keyword">benchmark</span></span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">5740808</span> <span class="keyword">Oct</span> <span class="number">20</span> <span class="number">15</span>:<span class="number">55</span> redis-<span class="keyword">check</span>-aof</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">5740808</span> <span class="keyword">Oct</span> <span class="number">20</span> <span class="number">15</span>:<span class="number">55</span> redis-<span class="keyword">check</span>-rdb</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">2605168</span> <span class="keyword">Oct</span> <span class="number">20</span> <span class="number">15</span>:<span class="number">55</span> redis-cli</span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root      <span class="number">12</span> <span class="keyword">Oct</span> <span class="number">20</span> <span class="number">15</span>:<span class="number">55</span> redis-sentinel -&gt; redis-<span class="keyword">server</span></span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">5740808</span> <span class="keyword">Oct</span> <span class="number">20</span> <span class="number">15</span>:<span class="number">55</span> redis-<span class="keyword">server</span></span><br><span class="line">[huangkai@sjq01 <span class="keyword">bin</span>]$</span><br></pre></td></tr></table></figure></p>
<p><strong>4、复制配置文件</strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 redis-<span class="number">4.0</span>.<span class="number">1</span>]$ <span class="keyword">cp</span> redis.<span class="keyword">conf</span> ./<span class="keyword">conf</span>/</span><br><span class="line">[huangkai@sjq01 redis-<span class="number">4.0</span>.<span class="number">1</span>]$ <span class="keyword">cd</span> <span class="keyword">conf</span>/</span><br><span class="line">[huangkai@sjq01 <span class="keyword">conf</span>]$ <span class="keyword">ll</span></span><br><span class="line">total <span class="number">60</span></span><br><span class="line">-rw-rw-r--. <span class="number">1</span> huangkai huangkai <span class="number">57764</span> Oct <span class="number">20</span> <span class="number">16</span>:<span class="number">02</span> redis.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure></p>
<p><strong>5、启动服务</strong></p>
<p>编译完成后二进制文件是在src目录下，通过下面的命令启动Redis服务：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[huangkai@sjq01 redis<span class="number">-4.0</span><span class="number">.1</span>]$ ./bin/redis-server ./conf/redis.conf</span><br><span class="line"><span class="number">5290</span>:C <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.100</span> # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line"><span class="number">5290</span>:C <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.100</span> # Redis version=<span class="number">4.0</span><span class="number">.1</span>, bits=<span class="number">64</span>, commit=<span class="number">00000000</span>, modified=<span class="number">0</span>, pid=<span class="number">5290</span>, just started</span><br><span class="line"><span class="number">5290</span>:C <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.100</span> # Warning: no config file specified, <span class="built_in">using</span> the default config. In order to specify a config file use ./redis-server /path/to/redis.conf</span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.101</span> # You requested maxclients of <span class="number">10000</span> requiring <span class="built_in">at</span> least <span class="number">10032</span> max file descriptors.</span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.101</span> # Server can't <span class="built_in">set</span> maximum open files to <span class="number">10032</span> because of OS error: Operation not permitted.</span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.101</span> # Current maximum open files is <span class="number">4096.</span> maxclients has been reduced to <span class="number">4064</span> to compensate <span class="keyword">for</span> low ulimit. <span class="keyword">If</span> you need higher maxclients increase 'ulimit -n'.</span><br><span class="line">                <span class="keyword">_</span>.<span class="keyword">_</span>                                                  </span><br><span class="line">           <span class="keyword">_</span>.-``__ ''-.<span class="keyword">_</span>                                             </span><br><span class="line">      <span class="keyword">_</span>.-``    `.  `<span class="keyword">_</span>.  ''-.<span class="keyword">_</span>           Redis <span class="number">4.0</span><span class="number">.1</span> (<span class="number">00000000</span>/<span class="number">0</span>) <span class="number">64</span> bit</span><br><span class="line">  .-`` .-```.  ```\/    <span class="keyword">_</span>.,<span class="keyword">_</span> ''-.<span class="keyword">_</span>                                   </span><br><span class="line"> (    '      ,       .-`  | <span class="type">`,    )     Running</span> <span class="built_in">in</span> standalone mode</span><br><span class="line"> |<span class="type">`-._</span>`-...-` __...-.``-.<span class="keyword">_</span>|<span class="type">'` _</span>.-'|     <span class="type">Port</span>: <span class="number">6379</span></span><br><span class="line"> |    <span class="type">`-._</span>   `.<span class="keyword">_</span>    /     <span class="keyword">_</span>.-'    |     <span class="type">PID</span>: <span class="number">5290</span></span><br><span class="line">  `-.<span class="keyword">_</span>    `-.<span class="keyword">_</span>  `-./  <span class="keyword">_</span>.-'    <span class="keyword">_</span>.-'                                   </span><br><span class="line"> |<span class="type">`-._</span>`-.<span class="keyword">_</span>    `-.__.-'    <span class="keyword">_</span>.-'<span class="keyword">_</span>.-'|                                  <span class="type"></span></span><br><span class="line"><span class="type"> |    `-._</span>`-.<span class="keyword">_</span>        <span class="keyword">_</span>.-'<span class="keyword">_</span>.-'    |           <span class="type">http</span>://redis.io        </span><br><span class="line">  `-.<span class="keyword">_</span>    `-.<span class="keyword">_</span>`-.__.-'<span class="keyword">_</span>.-'    <span class="keyword">_</span>.-'                                   </span><br><span class="line"> |<span class="type">`-._</span>`-.<span class="keyword">_</span>    `-.__.-'    <span class="keyword">_</span>.-'<span class="keyword">_</span>.-'|                                  <span class="type"></span></span><br><span class="line"><span class="type"> |    `-._</span>`-.<span class="keyword">_</span>        <span class="keyword">_</span>.-'<span class="keyword">_</span>.-'    |                                  <span class="type"></span></span><br><span class="line"><span class="type">  `-._</span>    `-.<span class="keyword">_</span>`-.__.-'<span class="keyword">_</span>.-'    <span class="keyword">_</span>.-'                                   </span><br><span class="line">      `-.<span class="keyword">_</span>    `-.__.-'    <span class="keyword">_</span>.-'                                       </span><br><span class="line">          `-.<span class="keyword">_</span>        <span class="keyword">_</span>.-'                                           </span><br><span class="line">              `-.__.-'                                               </span><br><span class="line"></span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.103</span> # WARNING: The TCP backlog setting of <span class="number">511</span> cannot be enforced because /proc/sys/net/core/somaxconn is <span class="built_in">set</span> to the lower value of <span class="number">128.</span></span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.103</span> # Server initialized</span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.103</span> # WARNING overcommit_memory is <span class="built_in">set</span> to <span class="number">0</span>! Background save may <span class="built_in">fail</span> under low memory condition. To <span class="built_in">fix</span> this issue add 'vm.overcommit_memory = <span class="number">1</span>' to /etc/sysctl.conf and <span class="keyword">then</span> reboot or run the command 'sysctl vm.overcommit_memory=<span class="number">1</span>' <span class="keyword">for</span> this to take effect.</span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.103</span> # WARNING you have <span class="keyword">Transparent</span> Huge Pages (THP) support enabled <span class="built_in">in</span> your kernel. This will create latency and memory usage issues <span class="built_in">with</span> Redis. To <span class="built_in">fix</span> this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' <span class="built_in">as</span> root, and add it to your /etc/rc.local <span class="built_in">in</span> order to retain the setting <span class="built_in">after</span> a reboot. Redis must be restarted <span class="built_in">after</span> THP is disabled.</span><br><span class="line"><span class="number">5290</span>:M <span class="number">20</span> Oct <span class="number">14</span>:<span class="number">26</span>:<span class="number">05.103</span> * Ready to accept connections</span><br></pre></td></tr></table></figure></p>
<p>如果控制台出现如上信息，表示Redis已启动成功。</p>
<h2 id="连接测试"><a href="#连接测试" class="headerlink" title="连接测试"></a>连接测试</h2><p>你可以使用内置的客户端命令redis-cli进行使用，新开一个连接窗口<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@sjq01 ~]<span class="comment"># cd /usr/local/redis-4.0.1/bin/</span></span><br><span class="line">[root@sjq01 bin]<span class="comment"># ./redis-cli </span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> SET name huangkai</span><br><span class="line">OK</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> GET name</span><br><span class="line"><span class="string">"huangkai"</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="关闭服务"><a href="#关闭服务" class="headerlink" title="关闭服务"></a>关闭服务</h2><p>方式1、使用 <font color="red"><strong>kill</strong></font> 命令关闭进程(一般不建议此方式)</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@sjq01 bin]<span class="comment"># ps aux|grep redis</span></span><br><span class="line">huangkai  <span class="number"> 5290 </span> 0.3  0.7<span class="number"> 145248 </span><span class="number"> 7968 </span>pts/0    Sl+  14:26   0:04 ./redis-server *:6379</span><br><span class="line">root      <span class="number"> 5370 </span> 0.0  0.0<span class="number"> 112648 </span> <span class="number"> 964 </span>pts/1    R+   14:50   0:00 grep --color=auto redis</span><br><span class="line">[root@sjq01 src]<span class="comment"># kill -9 5290</span></span><br><span class="line">[root@sjq01 src]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;方式2、优雅关闭Redis<br>&nbsp;&nbsp;&nbsp;&nbsp;使用 <font color="red"><strong>SHUTDOWN</strong></font> 命令<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@sjq01 bin]<span class="comment"># ./redis-cli </span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> SHUTDOWN</span><br><span class="line"><span class="keyword">not</span> connected&gt; quit</span><br><span class="line">[root@sjq01 src]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<h2 id="WARNING-FIX"><a href="#WARNING-FIX" class="headerlink" title="WARNING FIX"></a>WARNING FIX</h2><p>从上面redis启动之后的控制台打出的信息来看，有3条WARNING信息。他们分别如下：</p>
<p><strong>1、WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</strong></p>
<p>解决方式：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">第一种：无需重启系统即可生效；但重启以后信息丢失</span><br><span class="line">[huangkai@sjq01 redis<span class="number">-4.0</span><span class="number">.1</span>]$ su - root	<span class="comment">#切换到root用户</span></span><br><span class="line">Password: </span><br><span class="line">Last login: Fri Oct <span class="number">20</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> CST <span class="number">2017</span> <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.184</span><span class="number">.1</span> <span class="literal">on</span> pts/<span class="number">1</span></span><br><span class="line">[root@sjq01 ~]<span class="comment"># echo 511 &gt;/proc/sys/net/core/somaxconn  #修改配置</span></span><br><span class="line">----------</span><br><span class="line">第二种：即可生效，重启不会丢失</span><br><span class="line">[root@sjq01 ~]<span class="comment"># vim /etc/sysctl.conf #打开配置文件，在其后追加</span></span><br><span class="line">net.core.somaxconn = <span class="number">511</span></span><br><span class="line">[root@sjq01 ~]<span class="comment"># sysctl -p	#使配置文件sysctl.conf生效</span></span><br></pre></td></tr></table></figure></p>
<p>原理：<br>对于一个TCP连接，Server与Client需要通过三次握手来建立网络连接.当三次握手成功后,我们可以看到端口的状态由LISTEN转变为ESTABLISHED,接着这条链路上就可以开始传送数据了.每一个处于监听(Listen)状态的端口,都有自己的监听队列.监听队列的长度,与如下两方面有关：一个是 somaxconn参数；另一个是使用该端口的程序中listen()函数.故而somaxconn会限制了接收新 TCP 连接侦听队列的大小。对于一个经常处理新连接的高负载 web服务环境来说，默认的 128 太小了。大多数环境这个值建议增加到 1024 或者更多。 服务进程会自己限制侦听队列的大小，常常在它们的配置文件中有设置队列大小的选项。大的侦听队列对防止拒绝服务 DoS 攻击也会有所帮助。</p>
<p>redis配置文件中有个参数，tcp-backlog默认值是511，而系统默认的somaxconn是128，所以redis启动以后报出这个warnning</p>
<p><strong>2、WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add ‘vm.overcommit_memory = 1’ to /etc/sysctl.conf and then reboot or run the command ‘sysctl vm.overcommit_memory=1’ for this to take effect.</strong></p>
<p>解决办法：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">第一种：无需重启系统即可生效；但重启以后信息丢失</span><br><span class="line">[huangkai@sjq01 redis<span class="number">-4.0</span><span class="number">.1</span>]$ su - root	<span class="comment">#切换到root用户</span></span><br><span class="line">Password: </span><br><span class="line">Last login: Fri Oct <span class="number">20</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> CST <span class="number">2017</span> <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.184</span><span class="number">.1</span> <span class="literal">on</span> pts/<span class="number">1</span></span><br><span class="line">[root@sjq01 ~]<span class="comment"># echo 1 &gt; /proc/sys/vm/overcommit_memory  #修改配置</span></span><br><span class="line">----------</span><br><span class="line">第二种：即可生效，重启不会丢失</span><br><span class="line">[root@sjq01 ~]<span class="comment"># vim /etc/sysctl.conf #打开配置文件，在其后追加</span></span><br><span class="line">vm.overcommit_memory=<span class="number">1</span></span><br><span class="line">[root@sjq01 ~]<span class="comment"># sysctl -p	#使配置文件sysctl.conf生效</span></span><br></pre></td></tr></table></figure></p>
<p>原理：</p>
<p>内核参数overcommit_memory 确定了内存分配策略，可选值为[0、1、2]<br>0： 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。<br>1： 表示内核允许分配所有的物理内存，而不管当前的内存状态如何。<br>2： 表示内核允许分配超过所有物理内存和交换空间总和的内存</p>
<p> 进程通常调用malloc()函数来请求分配内存，Linux支持超量分配内存，以允许分配比可用RAM加上交换内存的请求。Linux对大部分申请内存的请求都回复”yes”，以便能跑更多更大的程序。因为申请内存后，并不会马上使用内存。这种技术叫做Overcommit。当linux发现内存不足时，会发生OOM killer(OOM=out-of-memory)。它会选择杀死一些进程(用户态进程，不是内核线程)，以便释放内存。当oom-killer发生时，linux会选择杀死哪些进程？选择进程的函数是oom_badness函数(在mm/oom_kill.c中)，该函数会计算每个进程的点数(0~1000)。点数越高，这个进程越有可能被杀死。每个进程的点数跟oom_score_adj有关，而且oom_score_adj可以被设置(-1000最低，1000最高)。</p>
<p><strong>3、WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command ‘echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled’ as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</strong></p>
<p>意思是 你使用的是透明大页，可能导致redis延迟和内存使用问题<br>解决办法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">第一种方法：重启生效，不会丢失</span><br><span class="line">[huangkai@sjq01 redis-4.0.1]$ su - root	<span class="comment">#切换到root用户</span></span><br><span class="line">Password: </span><br><span class="line">Last login: Fri Oct 20 14:26:20 CST 2017 from 192.168.184.1 on pts/1</span><br><span class="line">[root@sjq01 ~]<span class="comment"># vim /etc/rc.d/rc.local #打开配置文件，在其后追加</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[root@sjq01 ~]<span class="comment"># cat /etc/rc.d/rc.local  #查看修改后的内容 </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"><span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"><span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class="line"><span class="comment"># that this script will be executed during boot.</span></span><br><span class="line">touch /var/lock/subsys/<span class="built_in">local</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@sjq01 ~]<span class="comment"># </span></span><br><span class="line">[root@sjq01 ~]<span class="comment"># reboot	#重启系统</span></span><br><span class="line">----------</span><br><span class="line">第二种方法：及时生效，重启丢失</span><br><span class="line">[root@sjq01 ~]<span class="comment"># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span></span><br></pre></td></tr></table></figure></p>
<p>原理：</p>
<p>正常来说，有两种方式来增加内存，可以管理的内存大小：<br>1.增大硬件内存管理单元的大小。<br>2.增大page的大小。<br>第一个方法不是很现实，现代的硬件内存管理单元最多只支持数百到上千的page表记录，并且，对于数百万page表记录的维护算法必将与目前的数百条记录的维护算法大不相同才能保证性能，目前的解决办法是，如果一个程序所需内存page数量超过了内存管理单元的处理大小，操作系统会采用软件管理的内存管理单元，但这会使程序运行的速度变慢。</p>
<p>从redhat 6（centos，sl，ol）开始，操作系统开始支持 Huge Pages，也就是大页。简单来说， Huge Pages就是大小为2M到1GB的内存page，主要用于管理数千兆的内存，比如1GB的page对于1TB的内存来说是相对比较合适的。</p>
<p>THP（Transparent Huge Pages）是一个使管理Huge Pages自动化的抽象层。目前需要注意的是，由于实现方式问题，THP会造成内存锁影响性能，尤其是在程序不是专门为大内内存页开发的时候，简单介绍如下：操作系统后台有一个叫做khugepaged的进程，它会一直扫描所有进程占用的内存，在可能的情况下会把4kpage交换为Huge Pages，在这个过程中，对于操作的内存的各种分配活动都需要各种内存锁，直接影响程序的内存访问性能，并且，这个过程对于应用是透明的，在应用层面不可控制,对于专门为4k page优化的程序来说，可能会造成随机的性能下降现象。</p>
<h2 id="将Redis命令加入环境变量"><a href="#将Redis命令加入环境变量" class="headerlink" title="将Redis命令加入环境变量"></a>将Redis命令加入环境变量</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[rootoot@sjq01 bin]# vim + /etc<span class="built_in">/profile </span> #打开配置文件，添加如下内容到最后</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:/usr/local/redis-4.0.1/bin</span><br><span class="line">[root@sjq01 bin]# source /etc<span class="built_in">/profile	</span>	#使配置文件生效</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Redis/">Redis</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/02/22/Redis_02_配置文件/" class="pre">Redis配置文件</a><a href="/2018/02/22/Nginx_01/" class="next">Nginx Linux 安装</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装环境"><span class="toc-text">安装环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载"><span class="toc-text">下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接测试"><span class="toc-text">连接测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关闭服务"><span class="toc-text">关闭服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WARNING-FIX"><span class="toc-text">WARNING FIX</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将Redis命令加入环境变量"><span class="toc-text">将Redis命令加入环境变量</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/SpringCloud_01_Eureka/">Spring Cloud Eureka 服务发现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Git/">Git 环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Thymeleaf_01/">Thymeleaf 教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Svn服务器搭建/">Linux Svn 服务器搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Spring_Boot_01/">Spring Boot 快速入门 - 1 分钟搭建 Web 应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Spring_Boot_02/">Spring Boot 添加 Thymeleaf 支持</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/SecureCRT_8_1/">SecureCRT 8.1 安装与破解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Redis_05_事务/">Redis 事务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Redis_04_发布与订阅/">Redis 发布与订阅</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/Redis_03_持久化/">Redis 持久化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Idea/" style="font-size: 15px;">Idea</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/JPA/" style="font-size: 15px;">JPA</a> <a href="/tags/MySql/" style="font-size: 15px;">MySql</a> <a href="/tags/Spring-Cloud/" style="font-size: 15px;">Spring Cloud</a> <a href="/tags/Tool/" style="font-size: 15px;">Tool</a> <a href="/tags/Svn/" style="font-size: 15px;">Svn</a> <a href="/tags/Spring-Boot/" style="font-size: 15px;">Spring-Boot</a> <a href="/tags/Thymeleaf/" style="font-size: 15px;">Thymeleaf</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Huangkai.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>